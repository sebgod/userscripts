#!/bin/bash

FIRST=$1
MMC=$(which mmc)
MER_LIB_DIR=$(dirname $(dirname $MMC))/lib/mercury/lib
MER_JAVA_LIB_DIR=$MER_LIB_DIR/java
MER_JAVA_CP=

for arg in "$@" 
do
	JAR=${MER_JAVA_LIB_DIR}/${arg}.jar
	echo $JAR
	if [ -r $JAR ] ; then
		if [ -z $MER_JAVA_CP ] ; then
			MER_JAVA_CP=$JAR
		else
			MER_JAVA_CP=$MER_JAVA_CP:$JAR
		fi
	fi
done

OPS="-s java --no-detect-libgrades --use-grade-subdirs -m"

if [ ! -z $MER_JAVA_CP ] ; then
	OPS="--java-classpath $MER_JAVA_CP $OPS"
fi

$MMC $OPS $*
if [[ $FIRST == lib* ]] ;
then
	LIB_INSTALL=$FIRST.install
	shift
	sudo $MMC $OPS $LIB_INSTALL $*
	sudo chmod 644 ${MER_JAVA_LIB_DIR}/*.jar
fi
